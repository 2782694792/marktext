## readelf

[Linux下的ELF文件、链接、加载与库（含大量图文解析及例程）_linux 库文件 装载过程_Adenialzz的博客-CSDN博客](https://blog.csdn.net/weixin_44966641/article/details/120631079)

1. **ELF**：（Executable and Linkable Format，可执行与可链接格式）属于**一类文件类型**，非指定某一后缀文件；

1. 作用：用于**查看二进制文件的命令行工具**，可以提供**二进制文件的结构、类型、动态链接**等信息，详细命令选项查看`附1`；

2. 通过选项 `-h` 或 `--file-header` 显示`文件头信息`，包含入口地址，类型，字节序等；

2. `Linux`下主要有如下三种文件：

   - **可执行文件（.out）**：

     1. 以 linux x32 可执行文件为例，其中 **Class** 代表目标文件的**字节序**（endianness），**Data** 表明文件中的**数据是按照什么格式（大端、小端）进行组织**，**OS/ABI** 指出对应的**操作系统类型**，**Type** 指出**文件类型（3种**，有可执行文件、共享库、可重定位目标文件） ；

     2. 关键字：**-h**  **可执行程序**  **字节序**  **数据组织格式**  **操作系统类型**  

     > 注：Entry point address：虚拟**入口地址**，**程序**的**执行起点**，是一个十六进制的内存地址；
     >
     > 1. 入口地址指向了程序的确定代码，负责初始化运行环境、全局变量等之后，最终跳转到 main 函数或其他程序的主要逻辑部分；
     > 2. 通过入口地址，操作系统将处理器的指令指针设置为该地址，处理器便会从此处开始执行；
   
   ![image-20230919084835094](E:\marktext\image cache\readelf_out)
   
   
   
   - **可重定位文件（.o文件）**：
   
     以 linux x32 可重定位文件为例，通过 `-s` 或 `--symbols` 显示**符号表的信息**，包括函数、变量、外部符号等；
   
     1. **符号表**：了解程序的结构和调试信息，通过其可找到相关的函数和变量等，以及符号对应的内存中的地址信息；
     2. `Symbol table '.symtab' contains <number> entries:`：显示符号表中包含的符号数量；
     3. 列表项：Num **索引号**，Value **符号地址**或偏移量，Size 符号**大小**，Type 符号**类型（函数、对象等）**；
     4. Bind **绑定类型**（全局或局部绑定）、Vis **可见性（默认、隐藏、保护）**、Ndx **所属节**、Name 符号**名称**；
   
     > 关键字：**-s**  **重定位文件**  **符号表**  **符号名称对应信息的类型、绑定、可见性**
   
   
   
   ![image-20230919200529482](E:\marktext\image cache\readelf_o.png)
   
   
   
   - **共享目标文件（.so）**：
   
     1. 以 linux x32 动态库文件为例，通过 `-d` 或 `--dynamic` 查看目标文件中的**动态段信息**，包括动态链接器的版本、动态链接库列表等；
     2. `Dynamic section '.dynamic' at offset <offset> contains <number> entries:`：动态段中的条目数量以及动态段在文件中的偏移量；
     3. 选项列表项：Tag **动态段**条目**列标题**，Type 动态段**标签类型**，Name/Value 动态段标签的**名称或值**；
   
     > 注：动态段中的**标签**可以提供诸如**共享库依赖**关系、**重定位表**、**符号解析等**动态链接信息；
     >
     > 查看动态段，可以了解目标文件在运行时与其他模块的交互方式，以及它所依赖的共享库等信息。
   
     关键字：**-d**  **共享目标文件**  **动态段**   **标签指明依赖关系、重定位、符号解析等**

![](E:\marktext\image cache\readelf_so.png)

## ldd

1. ldd（list, dynamic, dependencies）本身不是一个程序，而仅是一个**shell脚本**；
2. 作用：用于检查**二进制文件与系统中的共享库之间的依赖关系**，列出一个程序所**依赖**的动态链接库的**名称以及路径**信息；
3. 不同系统有不同的命令选项，统计于`附2`中；
4. 常用于：列出依赖库进行**依赖检查**、解决**版本冲突**、确定调试时是否**对应共享库**；

> 关键字：**依赖库  依赖关系 依赖名称与路径  版本信息** 

![](E:\marktext\image cache\linux-ldd.png)

## 附1

下面是一些常用的 `readelf` 命令选项及其描述：

- `-h` 或 `--file-header`：显示**文件头**信息，包括魔数、架构、入口点地址等。
- `-l` 或 `--program-headers`：显示**程序头（或段头）表**信息，包括段的起始地址、大小、属性等。
- `-S` 或 `--sections`：显示**节（section）头表**信息，包括节的名称、起始地址、大小、标志等。
- `-s` 或 `--symbols`：显示**符号表**的信息，包括函数、变量、外部符号等。
- `-d` 或 `--dynamic`：显示**动态链接器**相关信息，包括动态链接器的版本、动态链接库列表等。
- `-r` 或 `--relocs`：显示**重定位表**（relocation table）的信息，用于描述需要进行地址重定位的位置。
- `-V` 或 `--version-info`：显示共享目标文件的版本信息。
- `-A` 或 `--arch-specific`：显示与特定体系结构相关的额外信息。
- `-x <number or name>` 或 `--hex-dump=<number or name>`：以十六进制形式显示指定节的内容。
- `-a` 或 `--all`：显示所有信息，相当于同时使用了许多其他选项。

## 附2

`ldd` 命令有一些选项可用来改变其默认行为。下面是一些常用的 `ldd` 命令选项及其描述：

- `-v` 或 `--verbose`：显示详细的**依赖信息**，包括版本号和库的加载地址等。
- `-u` 或 `--unused`：只显示**未使用的依赖**库。
- `-d` 或 `--data-relocs`：显示包含在**数据段**中的**重定位项**。
- `-r` 或 `--function-relocs`：显示**函数重定位**项。
- `-u <symbol>` 或 `--unresolved-symbols=<symbol>`：显示指定符号的未解析引用。
- `-c` 或 `--convert-paths`：将动态库路径转换为包含 RPATH 或 RUNPATH 的**绝对路径**。
- `-f` 或 `--file`：指定要检查依赖关系的文件。
- `-s` 或 `--sysroot`：**指定根目录路径**，用于查找共享库时作为基准路径。
- `-x` 或 `--ignore-interpreters`：**忽略解释器所需的依赖库**。
- `-a` 或 `--all`：**递归显示所有依赖关系**。
