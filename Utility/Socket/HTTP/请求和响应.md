# HTTP 报文

- HTTP/1.1 以及更早的 HTTP 协议报文都是语义可读的；

- 在 HTTP/2 中，这些报文被嵌入到了一个新的二进制结构，帧；

> 帧允许实现很多优化，比如报文标头的压缩以及多路复用。

- 即使只有原始 HTTP 报文的一部分以 HTTP/2 发送出来，每条报文的语义依旧不变，客户端会重组原始 HTTP/1.1 请求。因此用 HTTP/1.1 格式来理解 HTTP/2 报文仍旧有效；
- 报文有两种类型：请求与响应。

## URL

包含了用于查询某个资源的详细信息：

```html
http://host[":"port][abs_path]
```

## 请求

- http 请求由**请求行**、**消息报头**、空行、**请求正文** 4 部分组成。

  ![](E:\MarkText\image cache\HTTP 请求.png)

- 示例报文：

  <img src="file:///E:/MarkText/image%20cache/HTTP%20请求报文.png" title="" alt="" data-align="center">

  - 一个 HTTP 的请求[方法](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Methods)，通常客户端的操作都是**获取资源（GET** 方法）或者**发送 [HTML 表单](https://developer.mozilla.org/zh-CN/docs/Learn/Forms)（POST** 方法）；
  - 获取的资源的路径 URL，它没有 [protocol](https://developer.mozilla.org/zh-CN/docs/Glossary/Protocol)（`http://`），[domain](https://developer.mozilla.org/zh-CN/docs/Glossary/Domain)（`developer.mozilla.org`），或是 TCP 的 [port (en-US)](https://developer.mozilla.org/en-US/docs/Glossary/Port "Currently only available in English (US)")（HTTP 一般在 80 端口）；
  - HTTP 协议版本号；
  - 为服务端表达其他信息的可选[标头](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers)；
  - 对于一些像 POST 的方法，报文的主体（body）就包含了发送的资源，这与响应报文的主体类似。

### 请求（状态）行

- 由 **Method**、**URL** 字段和 HTTP **Version** 三部分构成；
- 定义了请求的方式、地址和所遵循的 HTTP 协议版本；
- **HTTP 1.0** 定义了三种请求方法：**GET、POST、HEAD**；
- **HTTP 1.1** 新增五种：**OPTIONS、PUT、DELETE、TRACE、CONNECT**。

#### 请求方法

- 名称区分大小写；
- 当某个请求所针对的**资源不支持对应的请求方法**，返回状态码 **405**（Mothod Not Allowed）；
- 当**服务器不认识或者不支持**对应的请求方法时，应返回状态码 **501**（Not Implemented）;
- HTTP 服务器至少应该实现 GET、HEAD、POST 方法。

![](E:\MarkText\image cache\HTTP 请求方式.png)

### 请求头

- 消息报头由一系列的键值对组成，允许客户端像服务端发送一些附加信息或者自身信息；

![](E:\MarkText\image cache\HTTP 请求头.png)

### 请求正文

- 只有在发送 **POST** 请求时才会**有请求正文**，`GET`方法并**没有**请求正文。

## 响应

- HTTP 响应由 4 部分组成，包括**状态行**，**消息报头**，空行，**响应正文**。

![](E:\MarkText\image cache\HTTP 响应.png)

示例报文：

<img src="file:///E:/MarkText/image%20cache/HTTP%20响应报文.png" title="" alt="" data-align="center">

- HTTP 协议版本号；

- 状态码（[状态码（status code）](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status)），告知对应请求成功或失败，以及失败原因；

- 状态信息，是非权威的状态码描述信息，可以由服务端自行设定；

- HTTP [标头](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers)，与请求标头类似；

- 可选项，比起请求报文，响应报文中更常见地包含获取资源的主体。

### 响应状态行

- 由三部分组成，包括 HTTP **协议版本**，**状态码**，以及对状态码的**文本描述**。

```http
HTTP/1.1 200 OK （CRLF）
```

#### 状态码

- 状态代码有 **3 位数字**组成，第一个数字定义了响应的**类别**，有 5 种可能取值： 
  - `1xx`：**指示信息** - 表示请求已接收，继续处理；
  - `2xx`：**成功** - 表示请求已被成功接收、理解、接受；
  - `3xx`：**重定向** - 要完成请求必须进行更进一步的操作；
  - `4xx`：**客户端错误** - 请求有语法错误或请求无法实现；
  - `5xx`：**服务器端错误** - 服务器未能实现合法的请求。
- **常见状态码：**

> `200`： **OK** - 客户端请求成功；
> `400`： **Bad Request** - 客户端请求有语法错误，不能被服务器所理解；
> `401`： **Unauthorized** - 请求未经授权，这个状态代码必须和`WWW-Authenticate`报头域一起使用；
> `403`： **Forbidden** - 服务器收到请求，但是拒绝提供服务；
> `404`： **Not Found** - 请求资源不存在，eg：输入了错误的URL；
> `500`： **Internal Server Error** - 服务器发生不可预期的错误；
> `503`： **Server Unavailable** - 服务器当前不能处理客户端的请求，一段时间后,可能恢复正常。

![](E:\MarkText\image cache\HTTP 响应状态码1.png)

![](E:\MarkText\image cache\HTTP 响应状态码2.png)

![](E:\MarkText\image cache\HTTP 响应状态码3.png)
