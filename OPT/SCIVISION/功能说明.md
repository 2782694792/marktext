# [使用功能说明书](E:\OPT\SciVision 3.1.2010.7\docs\quick_guide.pdf)

# 1 功能简介

SciVison 满足专业视觉库的所有要求：

        除了图像处理功能，SciVision 还提供了在视觉应用中通常需要的功能，例如图像采集、

串口、TCP/IP 通讯、文件处理、数据分析、脚本运算等。

## 1.1 主要特征

#### 1、技术高端

    除了标准的机器视觉算法，还提供了一系列高端视觉库，如自动标定、亚像素边缘提取、亚像素轮廓操作、任意形状的感兴趣区域选择、文本\数据的显示与存储、3D 匹配、3D 测量等。

#### 2、适用广泛

    可以让用户根据自己的需求灵活开发应用程序，广泛应用于 10000 多台设备。

#### 3、快速原型、开放式的架构

    可根据情况选择满足条件的图像采集硬件，同时如果采用 SciVision 不支持的图像采集设备，也可以直接将数据转换成 SciVision 对应的格式。

    SciVision 提供了算法库的同时也提供了标准的可视化界面，其中算法类有着灵活、底层、适合定制界面和实现自定义算法等特点，界面类则有着集成GUI 界面，客户可以快速的检查图像和结果，并快速找到合适的参数来解决视觉任务。

## 2 开发应用

### 2.1 SciVision 架构

架构特征：

- 高效：算子执行时间尽可能短；

- 开放：可以在不同的编程语言中使用 SciVision，还支持外部数据传递给 SciVision 并访问 SciVision 的数据。有透明的接口来集成用户定义的操作和非标准的图像获取设备；

- 标准：标准化的面向对象接口设计。

功能结构：

<img src="file:///D:/Download/MarkText/workspace/image/2022-10-19-15-15-24-image.png" title="" alt="" data-align="center">

**公共部分**：主要包括数据结构，数据结构间的转换以及图像显示控件；

**图像采集**：图像的采集、标定、校正、像素值的操作以及图像的自动对焦
            （用于评判图像的清晰度）；

**图像增强**：有关图像预处理的算法，如：滤波、二值化、形态学处理、
               图像的亮度对比度调节、彩色图像通道提取、图像的旋转、采样、镜像操作、
               边缘检测以及傅里叶变换等;

**图像定位**：通过找点的方式拟合直线、圆；
               通过灰度匹配、形态匹配和特征匹配提取物体的特征进行定位；
               根据特征点和物体的位置角度对 ROI 进行补正，实现物体的定位；

**测量**：卡尺测量以及几何测量；

**检测**：通过 Blob 分析提取出目标物体的一些基本特征数据用于分析；

**分类识别**：主要介绍了一维码识别（39 码、UPC 码、128 码、EAN 码等）、
               二维码识别（PDF417 码、QR 码、DataMatrix 码）；

**控制**：对数据的读写保存，如 Excel、INI 和 XML 文件的读写。

### 2.2 应用示例

#### 2.2.1 FindCircle

##### 2.2.1.1 显示图像

```cpp
CStatic * pStaticWnd = (CStatic*)GetDlgItem(IDC_IMG_WND); 
RECT rcParentWnd = {0};
pStaticWnd->GetWindowRect(&rcParentWnd); 
ScreenToClient(&rcParentWnd); 
int lret = SciCreateImageWnd((long)m_hWnd, rcParentWnd.left
            , rcParentWnd.top, rcParentWnd.right, rcParentWnd.bottom 
            , &m_lWndID);
```

##### 2.2.1.2 FindCircle 界面

```cpp
// 获取图像 
SciImage image; 
SciGetCurrentImage(m_lWndID,&image); 
// 显示功能界面
int lret=m_findcircleDlg.ShowDialog(image);
```

##### 2.2.1.3 改变参数

```cpp
// 获取图像 
SciImage image; 
SciGetCurrentImage(m_lWndID, &image); 
// 设置参数 
SciROI ROI; 
SciPoint centerPoint(100,100); 
double radius = 100; 
ROI.GenCircle(centerPoint,radius); 
// 由里到外
SciCircleEdgeDirection edgeDirection = SCI_FINDCIRCLE_INNER_TO_OUTER; 
// 由暗到亮
SciEdgePolarity edgePolarity = SCI_TYPE_DARK_TO_BRIGHT; 
// 第一条边
SciEdgeType edgeType = SCI_TYPE_FIRST_EDGE; 
int minEdgeStrength = 100, searchLineCount = 30,rejectRatio = 4; 
int edgeWidth = 10, projectionWidth = 10; 
bool displayLineFlag = 0;
// 调用 SetParam 对界面参数进行设置 
int lret = m_findcircleDlg.SetParam(ROI, edgeDirection
            , edgePolarity, edgeType, minEdgeStrength
            , searchLineCount, rejectRatio, edgeWidth
            , projectionWidth, displayLineFlag); 
// 打开界面 
lret=m_findcircleDlg.ShowDialog(image)
```

##### 2.2.1.4 Execute

```cpp
/// 获取图像 
SciImage image; 
SciGetCurrentImage(m_lWndID, &image);

/// 声明界面变量 
SciROI ROI; 
// 边的方向
SciCircleEdgeDirection edgeDirection; 
// 边的极性
SciEdgePolarity edgePolarity; 
// 边类型
SciEdgeType edgeType; 
int minEdgeStrength, searchLineCount, rejectRatio
    , edgeWidth, projectionWidth;
bool displayLineFlag; 

/// 声明结果变量 
SciPointArray pointArray; 
SciPoint circleCenter; 
float circleRadius; 
// 有效点
SciPointArray effectivePoints; 
// 无效点
SciPointArray rejectPoints ; 
//调用 Execute 函数，Execute 需配合 SetParam 进行使用 
int lret = m_findcircleDlg.GetParam(&ROI, &edgeDirection
                , &edgePolarity, &edgeType, &minEdgeStrength
                , &searchLineCount, &rejectRatio, &edgeWidth
                , &projectionWidth, &displayLineFlag); 

lret = m_findcircleDlg.SetParam(ROI, edgeDirection
            , edgePolarity, edgeType, minEdgeStrength
            , searchLineCount, rejectRatio, edgeWidth
            , projectionWidth, displayLineFlag); 

lret = m_findcircleDlg.Execute(image, &pointArray, &effectivePoints
            , &rejectPoints ,&circleCenter,&circleRadius); 
// 清理图像控件上的 Overlay 
SciClearAllOverlay(m_lWndID); 

/// 显示找到的结果，生成一个圆 Overlay 并显示在图像控件上 
SciOverlay m_overlay; 
m_overlay.GenCircle(circleCenter, circleRadius); 
SciDrawOverlay(m_lWndID, m_overlay); 
SciRefresh(m_lWndID);
```

##### 2.2.1.5 FindCircle

```cpp
// 获取图像 
SciImage image; 
image.ReadImage("D:\\SciVision_Project\\FindCircle\\FindCircle\\1.bmp");
// 设置参数 
SciROI ROI; 
SciPoint centerPoint(240,220); 
double radius = 100; 
ROI.GenCircle(centerPoint,radius); 
SciCircleEdgeDirection edgeDirection = SCI_FINDCIRCLE_INNER_TO_OUTER; 
SciEdgePolarity edgePolarity = SCI_TYPE_DARK_TO_BRIGHT; 
SciEdgeType edgeType = SCI_TYPE_FIRST_EDGE;
int minEdgeStrength = 20, searchLineCount = 40,rejectRatio = 1
        ,edgeWidth = 1, projectionWidth = 20; 
// 声明结果变量 
SciPointArray pointArray; 
SciPoint circleCenter; 
float circleRadius; 
SciPointArray effectivePoints; 
SciRegion region; 
SciPointArray rejectPoints; 
// 声明算法类对象 
SciFindCircle m_findcircle; 
// 调用算法 FindCircle  
long lret = m_findcircle.FindCircle(image, ROI
                , region, edgeDirection, edgePolarity
                , edgeType, minEdgeStrength, searchLineCount
                , rejectRatio, edgeWidth, projectionWidth
                , &pointArray, &effectivePoints, &rejectPoints
                , &circleCenter, &circleRadius); 
// 利用图像控件显示所处理图像 
SciDisplayImage(m_lWndID, image); 
// 清理图像控件上的 Overlay 
SciClearAllOverlay(m_lWndID); 
// 显示找到的结果，生成一个圆 Overlay 并显示在图像控件上
SciOverlay m_overlay;
m_overlay.GenCircle(circleCenter,circleRadius); 
SciDrawOverlay(m_lWndID,m_overlay); 
SciRefresh(m_lWndID);
```

##### 2.2.1.6 错误码

错误码是一组数字，它会与错误讯息建立关联，并且可用来识别 SciVision 的特定问题。

> 错误码详细内容请查看 “SciErrorCode.h”

##### 2.2.1.7 语言包

```cpp
// 设置语言为英语 
int LanguageType; 
LanguageType = 1033; 

// 设置语言为中文
LanguageType = 2052;
m_MultiLanguage.SelectLanguage(LanguageType);
```

## 3 应用领域

### 3.1 图像增强

#### 3.1.1 滤波

> 在尽量保留图像细节特征的条件下对目标图像的噪声进行抑制的过程

#### 3.1.2 灰度二值化

> 对单通道灰度图像进行二值化处理，将灰度图像转换为只有黑白两色的二值图像

#### 3.1.3 彩色二值化

> 对彩色图像进行二值化处理，把彩色图像转换为只有黑白两色表示的二值图像

#### 3.1.4 形态学

> 腐蚀 ：利用结构元素作为“探针”在图像中不断的移动，在此过程中收集图像的信息，分析图像各部分间的逻辑关系，从而了解图像的结构特征

#### 3.1.5 通道提取

> 将多通道彩色图像按不同的图像模型提取其中某一通道图像具体灰度信息

#### 3.1.6 图像操作

> 利用当前图像与一个常量或者另外一张尺寸、通道数一致的图像进行加、减、乘、除、与、或、非等操作

#### 3.1.7 图像拼接

> 对两幅或两幅以上具有重叠区域的图像拼接缝合成一张图像

#### 3.1.8 图像采样

> 每间隔几个样值取样一次，实现任意尺寸的图像向下重采样

#### 3.1.9 图像亮度调节

> 改变其亮度值、对比度或者伽玛值，使其特征更加凸显，以便检测其特征。
> 
> 亮度是指图片的明亮程度。
> 
> 对比度是指颜色之间的对比程度, 对比度越大, 各颜色之间的分别越明显，特别是黑与白之间对比越明显。
> 
> 伽玛值是曲线优化调整，是亮度和对比度的辅助功能，对画面进行细微的明暗层次调整，控制整个画面对比度表现。

#### 3.1.10 图像旋转平移

> 图像旋转、图像平移都是图像的几何变换中的一种。
> 
> 图像几何变换不改变像素值，而是改变像素所在的位置。某些变换反映到目标图像上会使像素网格变形。为了避免像素重新采样过多，映射以相反的顺序进行，从目标图像到源图像。也就是说，对于目标图像的每个像素，计算相应“供体”的源图像中的像素坐标，并复制像素值。
> 
> 平移功能可根据水平或垂直，正方向或反方向，按像素为单位移动图像。

#### 3.1.11 图像镜像

> 可以将图像进行垂直、水平和关于中心进行翻转

#### 3.1.12 设置颜色查找表

> 通过不同的编码方式对灰度图像按查找表方式进行编码，使其某些特征更加突出，便于观察。此功能只支持单通道图像。

#### 3.1.13 图像裁剪

> 将图像中感兴趣区域裁剪成一幅新的图像

#### 3.1.14 快速傅里叶变换

> 快速傅里叶变换（FFT：Fast Fourier Transform) 是离散傅里叶变换的快速算法。
> 
>         将图像的从空域转换到频域，由图像 FFT 变换得到的频谱图，就是图像梯度的分布图。 频谱图上的各点与图像上各点并不存在一一对应的关系。
> 
> 傅里叶逆变换（IFFT：Inverse Fast Fourier Transform) 则是将图像从频域转换到空域。
> 
>         图像的频率是表征图像中灰度变化剧烈程度的指标，是灰度在平面空间上的梯度。 FFT 在滤波，灰度匹配（计算卷积）等功能模块中都起到非常重要的作用。

#### 3.1.15 直方图均衡化

> 直方图均衡化( Histogram Equalization ) 又称直方图平坦化,实质上是对图像进行非线性拉伸,重新分配图像象元值,使一定灰度范围内象元值的数量大致相等。这样,原来直方图中间的峰顶部分对比度得到增强,而两侧的谷底部分对比度降低,输出图像的直方图是一个较平的分段直方图:如果输出数据分段值较小的话,会产生粗略分类的视觉效果。

#### 3.1.16 光度立体

> 在光源固定可控的条件下，拍摄在不同光照条件下的观察物，拍摄过程中相机不动，获取多幅图像后由图像亮度计算物体表面法向量，再由物体表面法向量恢复物体面三维信息的技术;
> 
> 目的是为了检测出物体表面一些高度不一致的目标，比如：缺陷检测、凹凸字符检测等。

### 3.2 图像定位

#### 3.2.1 找点

> 在灰度图像上指定的直线上寻找合适的、符合条件的边缘点。

#### 3.2.2 找直线

> 在灰度图像上指定的区域内首先寻找合适的、符合条件的边缘点，然后将这些点拟合为一条直线

#### 3.2.3 找圆

> 在灰度图像上指定的区域内寻找合适的边缘点，并将这些点拟合为圆。

#### 3.2.4 ROI 校正

> 通过生成的旋转矩阵计算出 ROI 的新的位置。其工作原理是通过仿射变换求取其变化后的坐标，根据变换后的坐标重新生成 ROI。

#### 3.2.5 灰度匹配

> 以统计的观点将图像看成是二维信号，采用统计相关的方法寻找信号间的相关匹配。利用两个信号的相关函数，评价它们的相似性以确定其位置。

#### 3.2.6 轮廓匹配

> 一种利用物体的轮廓进行目标物识别的方法。

#### 3.2.7 特征匹配

> 利用图像中提取的特征点来进行计算特征描述符并最终实现图像匹配的过程。其匹配过程主要分三步：
> 
> （1）在图像中寻找特征点；
> 
> （2）对找到的特征点进行描述，得到合适的二进制串或多维向量，称为特征描述符；
> 
> （3）对在模板和目标图像中分别得到的特征描述符进行匹配，并最终计算出匹配得到的目标区域。

    在数字图像处理中，特征匹配主要适用于需要进行初定位以提供给其它算子进行下一步运行的基准位置，在一些不方便使用找边、找圆算子进行首次定位的情况下可以定位出目标区域。另一种主要应用是对较为复杂的图像区域进行定位，如文字，标签，商标等，对于这类纹理较多，灰度变化剧烈的图像区域采用特征匹配会有较好的效果。

#### 3.2.8 霍夫找圆

> 在灰度图像上指定的区域利用霍夫变换以及约束条件找到合适的多个圆，但是霍夫圆不能同时找到同心圆的多个圆,只能根据半径去选择想要的圆

#### 3.2.9 霍夫找直线

> 在灰度图像上指定的区域利用霍夫变换以及约束条件找到合适的多条直线，然后通过设置两条直线之间的最小距离将分开的两条直线连接起来。

### 3.3 图像测量

#### 3.3.1 卡尺

> 在灰度图像上指定的区域内寻找目标的两条平行边缘，并计算这两条边缘的距离。

#### 3.3.2 间隙测量

> 在一幅灰度图像的指定 ROI 区域中进行多个边缘间隙的测量。

#### 3.3.3 几何测量

> 用于测量物体的几何特征或确定指定特征之间的几何关系。

#### 3.3.4 自动对焦

> 是一个相机采集时协助调焦，使采集得到的图片达到最清晰程度的工具。
> 
>     在进行机器视觉检测之前，要求处理的图像尽可能拍得清晰，这时候就需要对相机镜头进行调焦。自动对焦模块会对采集得到的图像进行评分，获取评分最高的采集位置就是对焦最清晰位置。

#### 3.3.5 颜色测量

> 对感兴趣区域的直方图进行统计，然后计算该区域各个通道的平均灰度值，标准方差，最小灰度值，最大灰度值。目前支持的颜色空间有 RGB、HSL、HSV 以及 HSI。
> 
> 可以对原图像进行彩色二值化，用二值化的结果图像做 mask 区域内的颜色统计。

#### 3.3.6 亮度测量

> 对感兴趣区域进行亮度统计分析并计算统计信息，如：亮度平均值、亮度标准方差、最小亮度值以及最大亮度值。

#### 3.3.7 激光三角测量

> 通过激光和相机获取物体的三维信息，激光照射在物体上，根据物体的高度、宽度以及其他信息能产生包含物体三维信息的激光线，然后通过相机获取激光线，相当于将三维降到了 2 维，再根据图像中的灰度信息提取出激光线，最后由一些列的激光线重构出物体。
> 
>     该功能主要四个模块：相机采集、激光线提取与分析、重构物体、生成三维效果图。
> 
> 其中相机采集与激光线的提取、分析是同时进行的。采集结束后，由提取出的激光线重构出物体图像，最后由重构的图像生成三维图。

#### 3.3.8 对焦 3D 测量

> 指用运动机构带动相机和远心浅景深镜头（或显微镜）沿物件高度方向移动拍摄一系列图片。由于拍摄过程中相机参数一直不变，物件上任何一点拍摄清晰时相机的位置与该点的距离是一固定值，所以每一点拍摄清晰时的相机位置可以作为该点的相对高度。通过软件计算每个像素点对焦时相机拍摄所在位置，再计算拍摄位置差就得到像素点所对应的物件上任意两点的高度差。

### 3.4 图像检测

#### 3.4.1 Blob 分析

> 在机器视觉中，Blob 是指图像中的具有相似颜色、纹理等特征所组成的一块连通区域。
> 
> Blob 分析是将图像进行二值化，分割得到前景和背景，然后进行连通区域检测，从而得到 Blob 块的过程。简单来说，Blob 分析就是在一块“光滑”区域内，将出现“灰度突变”的小区域寻找出来。

#### 3.4.2 划痕检测

> 在平整的物件表面上面存在一段连续的污损，其特征是边缘灰度变化大，总体面积比一般的表面斑点大。

#### 3.4.3 边缘检测

> 数字图像的边缘检测是图像分割，目标区域识别和区域形状提取等图像分析领域十分重要的基础，是图像识别中提取图像特征的一个重要方法。
> 
>     边缘是图像上灰度变换最剧烈的地方，传统的边缘检测就是利用了这个特点，对图像各个像素进行微分或求二阶微分来确定边缘像素点。

#### 3.4.4 轮廓度

> 是指被测实际轮廓相对于理想轮廓的变动情况。

#### 3.4.5 轮廓操作

> 增加对轮廓的处理，可以将轮廓分割为线段和圆弧，可以用来提取线段和圆，连接断裂轮廓和去除干扰的轮廓信息，使用此功能将获得更完整的轮廓。

#### 3.4.6 轮廓对比

> 设置提取文件轮廓和标准轮廓。通过轮廓对比，得到标准轮廓与实际轮廓的之间的关系。

#### 3.4.7 变量模型

> 一种与理想模型（理想的统计模型）进行比对判断目标是否合格的方法。
> 
> 变量模型通过用一些合格的图片学习出一个标准模型，然后目标物体和标准模型进行比对，求出目标物体与标准模型之间的差异，从而判断目标物体是否合格。

#### 3.4.8 数据转换

> 通过定位的点，将点数据转换为轮廓数据。

#### 3.4.9 角点检测

> 用来获得图像特征的一种方法，广泛应用于运动检测、图像匹配、视频跟踪、三维建模和目标识别等领域中。

#### 3.4.10 缺陷边缘检测

> 在指定的边缘中找出突变位置。

### 3.5 图像识别

#### 3.5.1 字符识别

> 光学字符识别（Optical Character Recognition 简称 OCR）是用于各行各业中的流程组件的分类识别处理。这些可以包括标签，印刷文本，或 LED 显示器等。

#### 3.5.2 条码识别

> 一维码（即一维条形码，简称条码）检测，就是在一幅灰度图像的指定 ROI 区域中检测出所有符合参数条件的一维码，获得其解码字符串与位置信息。

#### 3.5.3 二维码识别

> 二维码检测，就是在一幅灰度图像的指定 ROI 区域中检测出所有符合参数条件的二维码，获得其解码字符串及其他商品信息。

#### 3.5.4 VerCode 码识别

> Vericode 是二维码中的一种，由 Veritec 公司提出。该符号是一种用于微小型产品上的二进制数据编码系统便于机器书写和阅读，准确性和可重复性达到了最佳水平，具有扩大和缩小数据单元而不改变其数据信息，可通过错误检测和纠正(EDAC)重新构建数据等特点。

#### 3.5.5 分类器

> 一个根据类别特征来进行分类的工具。分类器的基本原理是先向分类器中添加各个类别的样本特征，并设置输入特征的一些参数，根据添加的样本特征来训练分类器，用训练后的模型来对每一个待分类的特征，计算与各个类别偏离度，如果最小的偏离度比偏离度阈值小，就将该类作为分类的结果。
